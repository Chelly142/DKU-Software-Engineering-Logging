# File Programming 학습목표
- 디스크 구조에대한 이해
- 디스크에대한 시스템 프로그램 논의
- 파일 내부 구조에대한 이해
- 파일과 관련된 시스템 콜 학습
- 파일을 다루는 프로그램 작성

## 디스크 구조
- 디스크 구성 요소
  - Platter(플레터) : 정보가 기록되는 원판 
  - Spindle(스핀들) : 플래터를 회전시켜주는 회전축
  - Surface(서페이스)
  - Track(트랙) : 플래터 표면에서 회전축을 중심으로 하는 동심원 여러개의 트랙이 존재
  - Sector(섹터) : 트랙을 일정한 크기로 나누어 구분한 부분 일정한
  - Cylinder(실린더) : 플레터가 여러장일 때 다른면에 있는 동일 트렉들의 모임
  - Head(헤드) : 데이터를 읽거나 쓸 때 쓰이는 장치 이놈으로 플레터를 자화 시키는거
  - ARM(암) : 플래터의 특정 트랙, 섹터로 접근하게 해주는 팔
  
- 디스크 접근
결국 헤드가 원하는 정보가있는 섹터로 가서 정보를 읽거나 써야한다 따라서 헤드가 움직이는 과정이 모두 물리적으로 이루어진다
Seek time : 헤드가 적절한 트렉으로 가기까지에 시간
Rotational latency : 플레터가 회전함에 따라 원하는 섹터가 헤드 밑으로 오기까지의 대기 시간
Transmission time : 섹터에 정보를 읽고, 쓰는 시간

- 디스크 vs. 플래쉬 메모리
  - 플레시 메모리는 디스크와 달리 기계적으로 작동하지 않아 빠르고 가볍다
  - 디스크는 데이터가 있든없든 덮어 쓰지만 플레시 메모리는 데이터가 있는 경우 지우고 써야하는 과정이 필요하다
  - 플래쉬 메모리는 블록단위로 지우고 쓰기 때문에 지우고싶지 않은 데이터도 함께 지워질수있다 
  - 플래쉬 메모리는 지울수있는 횟수의 제한이 있다
  - 위와 같은 플래시 메모리의 단점을 해결하기위한 소프트웨어 FTL을 개발함
  
## 디스크에대한 시스템 프로그램
- 디스크 디바이스 드라이버
  - 물리적인 하드디스크를 논린적인 디스크로 추상화 시킨다.(헤더나 플레터 이런거 알필요없어!)
  - 논리적 디스크는 디스크 블럭들의 집합이고 블럭의 크기는 페이지의 크기와 같다(보통 4KB)
- File system
  - 논리적인 디스크를 문자열(바이트 집합)로 되어있는 파일로 추상화 시켜준다.
  - 추상화된 파일은 논리적 디스크에 여러 블럭들로 이루어져있다.
  - 한 파일에 디스크 블럭을 할당하는 방법에는 연속할당(성능이 좋다)과 불연속 할당(유연성이 좋다. 이걸 많이 사용)이있다.
  - Inode
    - 파일을 관리 하기위한 메타데이터(데이터를 설명하는 테이터, 데이터들과는 다른곳에 저장)
    - 파일의 모든 속성 정보를 관리(ls-l 명령어로 볼수있는 모든 정보)
    - inode는 디스크에 저장되어있고 파일이 하나 만들어지면 같이 생성된다.
    - inode 는 속성과 위치로 구성된다. 속성은 파일의 속성에대한 설명이 담겨있다.
    - 위치 정보는 direct block 과 indirect block 으로 나뉘는 direct block(12개) 은 직접 데이터를 가리키고  indirect block(1중,2중,3중 총 3개)은 index block을 가리킨다.
    - index block 주소를 가리키는 포인터를 저장하는 block 이다 .
    - index block 을 활용하면 파일의 크기가 커져도 저장이 가능하다.(1중, 2중, 3중)
- System call
  - 이제 inode? ,블럭? 다 필요없고 시스템 콜로 파일을 열고 닫고 할수있음 이 역시 킹갇추상화
  - file discription = fd(파일 이름)만 알면 inode 필요없이 시스템 콜로 파일 접근 가능 
  - open() : 경로이름, 플레그, 모드를 인자로 가지며 플래그는 이 파일을 열때 다양한 상황에대한 대처를 모드는 파일을 열때 파일 접근 모드를 결정한다(r,w,x) return 값은 성공하면 파일 디스크립터를 실패시 -1을 준다.
  - read(), write() : 파일 디스크립터, 버퍼, 사이즈 를 인자로 가지며 open의 리턴값으로 받은 파일 디스크립터를 줄수있고 버펀ㄴ데이터를 가지고있을 메모리 공간 사이즈는 읽을 사이즈이다. 리턴값으로는 읽은 사이즈 실패 시 -1(버퍼 크기는 메모리 공간과 성능에 연관되어있음)
  - lseek() : 파일의 offset을 수정하게해주는 시스템 콜 파일 디스크립터, offset,whence 를 인자로 가진다. whence를 기준으로 offset만큼 offset을 이동 시킨다
  - link() : 열려있는 파일 자체를 다른 파일의 inode를 가리키게 해 연결 시키는 시스템 콜
  - dup(), dup2() : 파일 디스크립터를 같은 파일을 가리키게 하는 시스템 콜
